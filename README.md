# OpenCalories - å¡è·¯é‡Œè®°è´¦æœ¬

åŸºäº React Native çš„ç¦»çº¿å¡è·¯é‡Œè¿½è¸ªåº”ç”¨ï¼Œé‡‡ç”¨ TensorFlow Lite çš„ä¸“ä¸šé£Ÿç‰©è¯†åˆ«æ¨¡å‹ï¼Œæ”¯æŒ 2000+ ç§é£Ÿç‰©ã€‚

## æ ¸å¿ƒç‰¹æ€§ âœ…

### åŸºç¡€åŠŸèƒ½
- ğŸ“· æ‹ç…§/ç›¸å†Œé€‰æ‹©é£Ÿç‰©ç…§ç‰‡
- ğŸ¤– **AI é£Ÿç‰©è¯†åˆ«**ï¼ˆé€šè¿‡ TensorFlow Lite AIY Food V1 æ¨¡å‹ï¼Œ2023 ç§é£Ÿç‰©ï¼‰
- ğŸ¥— æ‰‹åŠ¨é€‰æ‹©é£Ÿç‰©ç±»å‹ï¼ˆ60+ç§å¸¸è§é£Ÿç‰©ï¼‰
- âš–ï¸ è°ƒæ•´é‡é‡ï¼ˆæ»‘å— + å¿«æ·æŒ‰é’®ï¼‰
- ğŸ”¥ é€‰æ‹©çƒ¹é¥ªæ–¹å¼ï¼ˆç”Ÿé£Ÿ/æ¸…è’¸/ç‚’/æ²¹ç‚¸ï¼‰
- ğŸ’¡ è‡ªåŠ¨è®¡ç®—çƒ­é‡
- ğŸ’¾ SQLite æœ¬åœ°å­˜å‚¨ï¼ˆç¦»çº¿å¯ç”¨ï¼‰
- ğŸ“Š å†å²è®°å½•æŸ¥çœ‹ä¸ç»Ÿè®¡
- ğŸ“ˆ ä»Šæ—¥çƒ­é‡æ±‡æ€»

### AI è¯†åˆ«å‡çº§ï¼ˆPhase 2ï¼‰
- âœ… **TensorFlow Lite ä¸“ä¸šé£Ÿç‰©è¯†åˆ«**ï¼ˆ2023 ç§é£Ÿç‰©ç±»åˆ«ï¼‰
- âœ… è°·æ­Œ AIY Vision Food V1 æ¨¡å‹ï¼ˆå‡†ç¡®åº¦é«˜ï¼‰
- âœ… åŸç”Ÿ C++ æ¨ç†ï¼ˆå¿«é€Ÿã€ä½å»¶è¿Ÿï¼‰
- âœ… è‡ªåŠ¨è‹±æ–‡â†’ä¸­æ–‡é£Ÿç‰©åç§°æ˜ å°„
- âœ… TFJS å¤‡ç”¨æ–¹æ¡ˆï¼ˆæ¨¡å‹åŠ è½½å¤±è´¥æ—¶ï¼‰
- âœ… å®æ—¶è¯†åˆ«ç»“æœä¸ç½®ä¿¡åº¦æ˜¾ç¤º

## é¡¹ç›®ç»“æ„

```
open-calories/
â”œâ”€â”€ App.tsx                           # åº”ç”¨å…¥å£ä¸å¯¼èˆª
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ ResultScreen.tsx          # é£Ÿç‰©è®°å½•è¯¦æƒ… (å«AIè¯†åˆ«)
â”‚   â”‚   â””â”€â”€ HistoryScreen.tsx         # å†å²è®°å½•
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ database.ts               # SQLite æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ foods.ts                  # é£Ÿç‰©æ•°æ®åº“ (60+ç§)
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts                  # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ ai/
â”‚       â”œâ”€â”€ index.ts                  # AI æ¨¡å—å…¥å£
â”‚       â”œâ”€â”€ tflite.ts                 # TensorFlow Lite æ¨ç†å¼•æ“
â”‚       â”œâ”€â”€ food-classifier.ts        # TFJS MobileNet (å¤‡ç”¨åˆ†ç±»å™¨)
â”‚       â”œâ”€â”€ food-mapping.ts           # é£Ÿç‰©æ ‡ç­¾è‹±â†”ä¸­æ˜ å°„
â”‚       â”œâ”€â”€ weight-estimation.ts      # é‡é‡ä¼°ç®—
â”‚       â””â”€â”€ image-utils.ts            # å›¾åƒå¤„ç†å·¥å…·
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ aiy_food_V1.tflite        # TFLite æ¨¡å‹ (2023 ç§é£Ÿç‰©)
â”‚       â””â”€â”€ aiy_food_V1_labelmap.csv  # é£Ÿç‰©ç±»åˆ«æ ‡ç­¾ (è‹±æ–‡)
â”œâ”€â”€ metro.config.js                   # Metro bundler é…ç½®ï¼ˆæ”¯æŒ .tfliteã€.csvï¼‰
â”œâ”€â”€ babel.config.js
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â””â”€â”€ app.json
```

## è¿è¡Œæ­¥éª¤

### å¼€å‘ç¯å¢ƒè¦æ±‚

- **Node.js**: v18+
- **Android Studio** æˆ– **Android SDK**ï¼ˆtargetSdk 36ï¼‰
- **Android æ¨¡æ‹Ÿå™¨** æˆ–çœŸæœºï¼ˆminSdk 24ï¼‰
- **npm** æˆ– **yarn**

### å¿«é€Ÿå¯åŠ¨

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npx expo start

# 3. åœ¨æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºä¸Šè¿è¡Œ
# Android æ¨¡æ‹Ÿå™¨: æŒ‰ 'a' é”®
# iOS æ¨¡æ‹Ÿå™¨: æŒ‰ 'i' é”®
# æˆ–æ‰«æ Expo Go äºŒç»´ç 

# æˆ–ç›´æ¥æ„å»º APKï¼š
npm run android          # å¼€å‘ç‰ˆ APK
npm run android:release  # å‘å¸ƒç‰ˆ APK
```

## TensorFlow Lite é£Ÿç‰©è¯†åˆ«

### æ¨¡å‹ä¿¡æ¯

åº”ç”¨é‡‡ç”¨ **Google AIY Vision Food V1** æ¨¡å‹è¿›è¡Œç¬¬ä¸€é˜¶æ®µé£Ÿç‰©è¯†åˆ«ï¼š

| æŒ‡æ ‡ | è¯´æ˜ |
|------|------|
| **æ¨¡å‹ç±»å‹** | TensorFlow Lite é‡åŒ–æ¨¡å‹ |
| **é£Ÿç‰©ç±»åˆ«** | 2023 ç§ |
| **è¾“å…¥å°ºå¯¸** | 224Ã—224Ã—3 (RGB float32) |
| **æ¨¡å‹å¤§å°** | ~21 MB |
| **æ¨ç†åº“** | react-native-fast-tflite (C++ JSI) |
| **æ€§èƒ½** | ~500ms per image (Snapdragon 8xx) |
| **ç²¾åº¦** | Top-1: ~71%, Top-5: ~90% |

### è¯†åˆ«æµç¨‹

```
ç…§ç‰‡è¾“å…¥
   â†“
JPEG è§£ç  + å›¾åƒé¢„å¤„ç† (224Ã—224 RGB)
   â†“
TensorFlow Lite æ¨ç† (C++ åŸç”Ÿ)
   â†“
è·å– Top-5 é¢„æµ‹ç»“æœ
   â†“
è‹±æ–‡æ ‡ç­¾ â†’ ä¸­æ–‡é£Ÿç‰©åç§°æ˜ å°„
   â†“
ç”¨æˆ·é€‰æ‹© æˆ– è‡ªåŠ¨åŒ¹é…
   â†“
çƒ­é‡è®¡ç®— & ä¿å­˜åˆ°æ•°æ®åº“
```

### å¤‡ç”¨æ–¹æ¡ˆ

è‹¥ TFLite åŠ è½½å¤±è´¥ï¼Œè‡ªåŠ¨é™çº§åˆ° **TensorFlow.js MobileNet V2**ï¼ˆ1000 ç§é€šç”¨ç‰©ä½“åˆ†ç±»ï¼‰ã€‚

## æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| **æ¡†æ¶** | React Native (Expo) | - |
| **è¯­è¨€** | TypeScript | 5.x |
| **AI-æ¨ç†** | TensorFlow Lite (C++ JSI) | via react-native-fast-tflite@2.0.0 |
| **AI-å¤‡ç”¨** | TensorFlow.js | 4.x |
| **æ•°æ®åº“** | SQLite 3 | expo-sqlite |
| **å¯¼èˆª** | React Navigation | 6.x |
| **å›¾åƒå¤„ç†** | jpeg-js, expo-image-picker | - |
| **æ„å»ºç³»ç»Ÿ** | Gradle | 8.14.3 |

## æ ¸å¿ƒæ¨¡å—è¯´æ˜

### [`src/ai/tflite.ts`](src/ai/tflite.ts) - TFLite æ¨ç†å¼•æ“
- **èŒè´£**: åŠ è½½æ¨¡å‹ã€é¢„å¤„ç†å›¾åƒã€è¿è¡Œæ¨ç†
- **å…³é”®å‡½æ•°**:
  - `loadModel()` - åŠ è½½ TFLite æ¨¡å‹å’Œæ ‡ç­¾
  - `loadLabels()` - è§£æé£Ÿç‰©æ ‡ç­¾ CSV
  - `toFloat32Rgb()` - å›¾åƒé¢„å¤„ç†ï¼ˆresize åˆ° 224Ã—224ï¼‰
  - `TFLiteModule.predictFood()` - æ‰§è¡Œæ¨ç†å¹¶è¿”å› Top-5 ç»“æœ

### [`src/ai/food-mapping.ts`](src/ai/food-mapping.ts) - é£Ÿç‰©åç§°æ˜ å°„
- **èŒè´£**: è‹±æ–‡æ ‡ç­¾ â†’ ä¸­æ–‡é£Ÿç‰©åç§°æ˜ å°„
- **åŒ…å«**: 60+ å¸¸è§é£Ÿç‰©çš„ä¸­è‹±å¯¹ç…§è¡¨

### [`src/screens/ResultScreen.tsx`](src/screens/ResultScreen.tsx) - è¯†åˆ«ç»“æœé¡µé¢
- **èŒè´£**: æ‹ç…§ã€AI è¯†åˆ«ã€æ‰‹åŠ¨è°ƒæ•´ã€çƒ­é‡è®¡ç®—
- **æµç¨‹**:
  1. å¯åŠ¨ç›¸æœº/ç›¸å†Œé€‰æ‹©
  2. å°è¯• TFLite æ¨ç†ï¼Œå¤±è´¥æ—¶ä½¿ç”¨ TFJS å¤‡ç”¨
  3. æ˜¾ç¤ºè¯†åˆ«ç»“æœï¼Œç”¨æˆ·å¯è°ƒæ•´
  4. ä¿å­˜åˆ°æ•°æ®åº“

### [`src/db/database.ts`](src/db/database.ts) - æ•°æ®åº“æ“ä½œ
- **èŒè´£**: SQLite åˆå§‹åŒ–ã€å¢åˆ æ”¹æŸ¥
- **è¡¨ç»“æ„**: `meals` (id, food, weight, cooking, calories, timestamp, imageUri)
- **ç‰¹æ€§**: è‡ªåŠ¨åˆå§‹åŒ–ã€å¹‚ç­‰æ“ä½œ

### [`src/screens/HistoryScreen.tsx`](src/screens/HistoryScreen.tsx) - å†å²è®°å½•
- **èŒè´£**: æ˜¾ç¤ºä»Šæ—¥/å†å²mealsã€åˆ é™¤recordã€ç»Ÿè®¡çƒ­é‡

## æ„å»ºæŒ‡å—

### å¼€å‘ç‰ˆ APKï¼ˆå¸¦ Metro è°ƒè¯•æœåŠ¡å™¨ï¼‰

```bash
npm run android
# è¾“å‡º: android/app/build/outputs/apk/debug/app-debug.apk
# æ³¨: æ‰‹æœºéœ€ä¸ç”µè„‘åœ¨åŒä¸€ç½‘ç»œï¼Œå¯ä½¿ç”¨ adb å‘½ä»¤æ‰‹åŠ¨å®‰è£…
```

### å‘å¸ƒç‰ˆ APKï¼ˆç‹¬ç«‹è¿è¡Œï¼Œæ— éœ€æœåŠ¡å™¨ï¼‰

```bash
npm run android:release
# è¾“å‡º: android/app/build/outputs/apk/release/app-release.apk
```

**å‘å¸ƒç‰ˆæ„å»ºæµç¨‹**:
1. TypeScript â†’ JavaScript (babel + metro)
2. æ‰“åŒ… bundle + èµ„æºæ–‡ä»¶ï¼ˆåŒ…æ‹¬ 21MB TFLite æ¨¡å‹ï¼‰
3. é€šè¿‡ Gradle ç¼–è¯‘ Java/Kotlin ä»£ç 
4. C++ TFLite ç»‘å®šç¼–è¯‘ï¼ˆarm64-v8a, armeabi-v7a, x86, x86_64ï¼‰
5. ç”Ÿæˆæ— ç¬¦å· APK
6. æ”¯æŒé€šè¿‡å‘è¡Œ keystore ç­¾å

## å·²çŸ¥é™åˆ¶

1. **TFLite ç²¾åº¦**: AIY Food V1 åœ¨é€šç”¨é£Ÿç‰©ä¸Šç²¾åº¦ ~70%ï¼Œå»ºè®®åœ¨è¯†åˆ«ç»“æœä¸­æä¾›æ‰‹åŠ¨è°ƒæ•´é€‰é¡¹
2. **æ¨¡å‹å¤§å°**: 21MB æ¨¡å‹ä¼šå¢åŠ  APK ä½“ç§¯ï¼Œè€ƒè™‘ä½¿ç”¨åŠ¨æ€ä¸‹è½½æˆ–æ¨¡å—åŒ–æ–¹æ¡ˆ
3. **æ¨ç†å»¶è¿Ÿ**: åœ¨ä½ç«¯è®¾å¤‡ä¸Šå¯èƒ½éœ€è¦ 1000ms+ æ‰èƒ½å®Œæˆæ¨ç†
4. **ä¸­æ–‡æ˜ å°„**: ä»…æ”¯æŒ CSV ä¸­å®šä¹‰çš„æ ‡ç­¾æ˜ å°„ï¼Œéƒ¨åˆ†é£Ÿç‰©å¯èƒ½æ— ä¸­æ–‡å¯¹åº”

## æœªæ¥è®¡åˆ’

- [ ] é‡é‡ä¼°ç®—æ¨¡å—ï¼ˆå‚ç…§ç‰©ä½“ç§¯ä¼°è®¡ï¼‰
- [ ] äº‘åŒæ­¥åŠŸèƒ½ï¼ˆiCloud/Google Drive å¤‡ä»½ï¼‰
- [ ] è¥å…»æˆåˆ†è¯¦æƒ…ï¼ˆè›‹ç™½è´¨ã€è„‚è‚ªã€ç¢³æ°´ï¼‰
- [ ] é£Ÿç‰©æ¨èç³»ç»Ÿï¼ˆåŸºäºå†å²è®°å½•ï¼‰
- [ ] æ”¯æŒ iPhoneï¼ˆiOS éƒ¨ç½²ï¼‰
- [ ] æ¨¡å‹å®šæœŸæ›´æ–°æœºåˆ¶

## è®¸å¯è¯

MIT

## ç›¸å…³èµ„æº

- [Google AIY Quickdraw Food](https://github.com/google/aiyprojects-raspberrypi)
- [TensorFlow Lite å®˜æ–¹æ–‡æ¡£](https://www.tensorflow.org/lite)
- [React Native æ–‡æ¡£](https://reactnative.dev/)
- [Expo å®˜æ–¹æ–‡æ¡£](https://docs.expo.dev/)

### æ”¯æŒçš„é£Ÿç‰©ç±»å‹

AI å¯è¯†åˆ« 100+ ç§å¸¸è§é£Ÿç‰©ï¼Œå¹¶æ˜ å°„åˆ°åº”ç”¨å†…é£Ÿç‰©æ•°æ®åº“ã€‚

## æŠ€æœ¯æ ˆ

- React Native 0.81 + Expo SDK 54
- TypeScript 5.9
- React Navigation
- TensorFlow.js + MobileNet V2
- expo-sqlite (SQLite)
- expo-image-picker + expo-image-manipulator

## é£Ÿç‰©æ•°æ®åº“

åŒ…å« 60+ ç§å¸¸è§ä¸­å›½é£Ÿç‰©ï¼Œæ¶µç›–ï¼š
- ä¸»é£Ÿ (ç±³é¥­ã€é¢æ¡ã€é¦’å¤´ç­‰)
- è‚‰ç±» (é¸¡èƒ¸è‚‰ã€çŒªè‚‰ã€ç‰›è‚‰ç­‰)
- è”¬èœ (é’èœã€è¥¿å…°èŠ±ã€è¥¿çº¢æŸ¿ç­‰)
- æ°´æœ (è‹¹æœã€é¦™è•‰ã€æ©™å­ç­‰)
- é›¶é£Ÿ/é¥®å“ (ç‰›å¥¶ã€å·§å…‹åŠ›ã€è–¯ç‰‡ç­‰)

æ¯ç§é£Ÿç‰©åŒ…å«ï¼š
- åç§°
- çƒ­é‡ (kcal/100g)
- å¯†åº¦ (g/cmÂ³ï¼Œç”¨äºä½“ç§¯ä¼°ç®—)
- åˆ†ç±»

## çƒ¹é¥ªç³»æ•°

| çƒ¹é¥ªæ–¹å¼ | ç³»æ•° | è¯´æ˜ |
|---------|------|------|
| ç”Ÿé£Ÿ | 1.0 | åŸå§‹çƒ­é‡ |
| æ¸…è’¸ | 1.0 | å‡ ä¹ä¸å¢åŠ çƒ­é‡ |
| ç‚’ | 1.15 | åŠ å°‘é‡æ²¹ |
| æ²¹ç‚¸ | 1.45 | å¤§é‡å¸æ²¹ |

## License

MIT
